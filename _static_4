!function(){"use strict";var e={243:function(e,t,o){o.d(t,{default:function(){return l}});const n="PMC: Piano: ",a=()=>{var e,t;return null===(t=null===(e=window.location)||void 0===e?void 0:e.search)||void 0===t?void 0:t.includes("pianoDebug")};let i;e=o.hmd(e);let r="";const s={initialized:!1,setDataForNewsletter:!1,targetElements:{paywall:".pmc-paywall",paywallFade:"a-article-nl-fade",overlay:"div[id=piano-paywall] .tp-container-inner"},signupURLs:{billboard:"https://cloud.email.billboard.com/signup/",sourcingjournal:"https://cloud.email.sourcingjournal.com/signup/",sportico:"https://cloud.email.sportico.com/signup/",wwd:"https://cloud.email.wwd.com/signup/",variety:"https://cloud.email.variety.com/signup/",rollingstone:"https://cloud.email.rollingstone.com/signup/"},modal:!0,emailInputFocused:!1,prepareExactTargetFormData:e=>{const t=Object.assign({__contextName:"FormPost",__executionContext:"Post"},e.data.formData),o=new FormData;for(let[e,n]of Object.entries(t))o.append(e,n);return o},sendSignupDataToExactTarget:e=>{const t=window.pmcPiano.newsletterForm,o=t.signupURLs[r];o||console.error(n,"Invaild brand for newsletter form submission",{brand:r,signupURLs:t.signupURLs}),fetch(o,{method:"POST",mode:"no-cors",body:e}).then((e=>{a()&&console.log(n,"POST request to ExactTarget successful:",e)})).catch((e=>{console.error(n,"Error sending formData to ExtactTarget:",e)}))},calculateTopOffset:()=>{var e,t,o,n;const a=(null===(e=document.querySelector("header"))||void 0===e?void 0:e.offsetHeight)||0,i=(null===(t=document.querySelector(".js-Header-contents"))||void 0===t?void 0:t.offsetHeight)||0,r=Math.min(Math.max(a,i)+20,100),s=null===(o=document.querySelector(".pmc-paywall > .jw-state-playing"))||void 0===o?void 0:o.offsetHeight,l=null===(n=document.querySelector(".live-event-banner > .banner-regular"))||void 0===n?void 0:n.offsetHeight;if(window.innerWidth<768){if(s>0)return r+s;if(l>0)return r+l}return r},stickyDismissableRegwall:()=>{const e=window.pmcPiano.newsletterForm,t=document.querySelector(e.targetElements.paywall),o=document.querySelector(`${e.targetElements.overlay} iframe`);t&&o?(t.classList.add(e.targetElements.paywallFade),window.addEventListener("scroll",(()=>{const o=document.querySelector(e.targetElements.overlay),n=t.getBoundingClientRect().top+window.scrollY,a=e.calculateTopOffset();o.style.top="0",o.style.zIndex="2",o.style.transition="top 0.1s ease 0s";const i=(t.getBoundingClientRect().top<=a?Math.min(Math.max(0,window.scrollY+a-n),t.clientHeight-o.clientHeight):0)+(e.emailInputFocused?-150:0);o.style.position="absolute",o.style.top=`${i}px`}))):setTimeout(e.stickyDismissableRegwall)},registerPostMessageListener:()=>{const e=window.pmcPiano.newsletterForm;window.addEventListener("message",(t=>{var o,s;if(t.origin.includes("tinypass.com")&&"string"==typeof t.type)switch(t.data.type){case"piano_template_newsletter_close_button_clicked":null===(o=document.querySelector(e.targetElements.paywall))||void 0===o||o.classList.remove(e.targetElements.paywallFade),null===(s=document.querySelector(e.targetElements.overlay))||void 0===s||s.classList.add("lrv-a-hidden");break;case"piano_template_newsletter_email_input":e.emailInputFocused=t.data.focused,window.dispatchEvent(new Event("scroll",{bubbles:!0}));break;case"piano_template_newsletter_submit_button_clicked":r=t.data.brand,i=e.prepareExactTargetFormData(t),e.sendSignupDataToExactTarget(i);break;case"piano_regwall_register_button_clicked":r=t.data.brand,i=e.prepareExactTargetFormData(t),e.setDataForNewsletter=!0,a()&&console.log(n,"Data Stored for Registration",i)}}))},registrationSuccess:function(e){const t=e.user.email;t&&this.setDataForNewsletter&&(this.setDataForNewsletter=!1,a()&&console.log(n,"Registration success",e),i.set("EmailAddress",t),setTimeout(this.sendSignupDataToExactTarget(i),1e3))},initialize:()=>{const e=window.pmcPiano.newsletterForm;e.initialized?a()&&console.log(n,"Newsletter Form is already initialized"):(a()&&console.log(n,"Initializing Newsletter Form"),e.modal&&e.stickyDismissableRegwall(),e.registerPostMessageListener(),window.pmcPiano.callbacks.onRegistration(e.registrationSuccess.bind(e)),e.initialized=!0)}};var l=s;"undefined"!=typeof exports&&(e.exports=s)}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n](i,i.exports,o),i.loaded=!0,i.exports}o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n=o(243);(window.pmcPiano=window.pmcPiano||{}).newsletterForm=n.default}();;
!function(){"use strict";var e={822:function(e,n,o){o.d(n,{default:function(){return a}});const i="PMC: Piano: ",t=()=>{var e,n;return null===(n=null===(e=window.location)||void 0===e?void 0:e.search)||void 0===n?void 0:n.includes("pianoDebug")};e=o.hmd(e);var r=function(e,n,o,i){return new(o||(o=Promise))((function(t,r){function l(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(l,a)}c((i=i.apply(e,n||[])).next())}))};const l={cookieLabel:"pmc_piano_reporting",reporting:{entitlements:"",user_type:"ANONYMOUS",acct_id:null,acct_type:null,org_id:null,org_name:null,paywall_logged_in:!1},initialize:function(){const e=this;window.pmcPiano.callbacks.onInit({knownUser:()=>{e.setDataForAuthUser()},unknownUser:()=>r(this,void 0,void 0,(function*(){e.hasReportingCookie()||(yield e.set(JSON.stringify(e.reporting)))}))}).onKnownIP((function(){e.reporting.acct_type="ip",e.reporting.user_type="KNOWN",e.set(JSON.stringify(e.reporting))})).onLogin((()=>{e.setDataForAuthUser()})).onLogout(e.delete.bind(e))},set:function(e){return r(this,void 0,void 0,(function*(){t()&&console.log(i,"Setting pmc_piano_reporting cookie",e),yield function(e){return n=this,o=arguments,t=function*(e,n=100){for(;!e();)yield new Promise((e=>setTimeout(e,n)))},new((i=void 0)||(i=Promise))((function(e,r){function l(e){try{c(t.next(e))}catch(e){r(e)}}function a(e){try{c(t.throw(e))}catch(e){r(e)}}function c(n){var o;n.done?e(n.value):(o=n.value,o instanceof i?o:new i((function(e){e(o)}))).then(l,a)}c((t=t.apply(n,o||[])).next())}));var n,o,i,t}((()=>void 0!==window.OptanonActiveGroups)),window.pmc.cookie.set(this.cookieLabel,e,604800,"/","targeting",this.tld())}))},delete:function(){t()&&console.log(i,"Deleting pmc_piano_reporting cookie"),window.pmc.cookie.expire(this.cookieLabel,"/",this.tld())},getDataForAuthUser:function(){return r(this,void 0,void 0,(function*(){var e,n,o,r,l;let a=null!==(e=yield window.pmcPiano.api.getConversionList())&&void 0!==e?e:[];const c=null!==(n=a.sort(((e,n)=>n.create_date-e.create_date))[0])&&void 0!==n?n:void 0;a=a.filter((e=>{var n;return null===(n=null==e?void 0:e.user_access)||void 0===n?void 0:n.granted})),a=0>=a.length?[c]:(e=>{let n=[];return 1>=e.length?e:(["( |^)corporate","( |^)education","( |^)partner","( |^)agent","( |^)billboard member","( |^)employee","( |^)comp","( |^)(limited|registration)"].forEach((o=>{var i,t,r;let l=0;for(;l<e.length;l++){const a=e[l];(null===(r=null===(t=null===(i=null==a?void 0:a.term)||void 0===i?void 0:i.resource)||void 0===t?void 0:t.name)||void 0===r?void 0:r.match(new RegExp(o,"i")))&&(n=[...n,a],e.splice(l,1),l--)}})),0<e.length&&(n=[...e,...n]),n)})([...a]);const d=((e,n)=>{var o,r;const l=e=>{var n,o;const i=null===(o=null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.resource.name)||void 0===o?void 0:o.toLocaleLowerCase();return(null==i?void 0:i.match(/( |^)agent/))?"agent":(null==i?void 0:i.match(/( |^)(corporate|education|employee|partner)/))?"site_license":"individual"},a=l(e);if(1>=n.length)return a;const c=n.slice(1).map((e=>l(e))),d="individual"===a,u=c.includes("agent"),s=c.includes("site_license");return d&&u&&s?"individual|site_license|agent":d&&s&&!u?"individual|site_license":d&&u&&!s?"individual|agent":"site_license"===a&&u?"site_license|agent":(t()&&console.log(i,`User might have duplicate resources. userId: ${null===(r=null===(o=null==e?void 0:e.user_access)||void 0===o?void 0:o.user)||void 0===r?void 0:r.uid} accountType: ${a}`),a)})(a[0],a),u=Array.from(new Set(a.map((e=>{var n;return null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.resource.name})))).join("|")||void 0,s=Array.from(new Set(a.map((e=>{var n;return null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.name})))).join("|")||void 0,v=Array.from(new Set(a.map((e=>(null==e?void 0:e.user_access)||(null==e?void 0:e.term)?((e={})=>{const n=null==e?void 0:e.user_access,o=null==e?void 0:e.term,i=null==o?void 0:o.resource;return(null==i?void 0:i.name)&&""!==i.name?(null==n?void 0:n.granted)&&(/registration/i.exec(null==o?void 0:o.name)||"registration"===(null==o?void 0:o.type))?"REGISTERED":(null==n?void 0:n.granted)?"SUBSCRIBER":void 0:"KNOWN"})(e):void 0)))).sort(((e,n)=>e.localeCompare(n))).join("|")||void 0,p=[];for(const e of a)(null===(o=null==e?void 0:e.term)||void 0===o?void 0:o.term_id)&&(m=null==e?void 0:e.term)&&("email_domain_contract"===(null==m?void 0:m.type)||"specific_email_addresses_contract"===(null==m?void 0:m.type))&&p.push(yield window.pmcPiano.api.getLicenseeData(e.term.term_id));var m;const g=Array.from(new Set(p.map((e=>null==e?void 0:e.id)))).join("|")||void 0,f=Array.from(new Set(p.map((e=>null==e?void 0:e.name)))).join("|")||void 0;return{accessGrantedStatus:null!==(l=null===(r=a[0])||void 0===r?void 0:r.user_access.granted)&&void 0!==l&&l,accountTermType:d,resourceName:u,termName:s,orgId:g,orgName:f,userType:v}}))},setDataForAuthUser:function(){return r(this,void 0,void 0,(function*(){const e=this,n=window.tp.pianoId.getUser();let o=e.hasReportingCookie();if((null==o?void 0:o.acct_id)===n.uid)return Promise.resolve();const i=yield this.getDataForAuthUser(),t={acct_id:n.uid,acct_type:i.accountTermType,entitlements:i.resourceName,paywall_logged_in:i.accessGrantedStatus,user_type:i.userType,org_id:i.orgId||null,org_name:i.orgName||null};return this.reporting=Object.assign(Object.assign({},e.reporting),t),yield e.set(JSON.stringify(this.reporting)),Promise.resolve()}))},hasReportingCookie:function(){try{return JSON.parse(window.pmc.cookie.get("pmc_piano_reporting")||null)}catch(e){return t()&&console.log(i,"No reporting cookie",e.toString()),!1}},tld:function(){return new URL(window.location.href).hostname.split(/\./).slice(-2).join(".")}};l.initialize();var a=l;"undefined"!=typeof exports&&(e.exports=l)}},n={};function o(i){var t=n[i];if(void 0!==t)return t.exports;var r=n[i]={id:i,loaded:!1,exports:{}};return e[i](r,r.exports,o),r.loaded=!0,r.exports}o.d=function(e,n){for(var i in n)o.o(n,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)};var i=o(822);(window.pmcPiano=window.pmcPiano||{}).reportingCookie=i.default}();;
